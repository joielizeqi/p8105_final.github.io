<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Cumulative impact of various factors on dog bite incidents</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="report.html">Report</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="team.html">Team</a>
    </li>
    <li>
      <a href="datasource.html">Data source</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="eda.html">Exploratory Data Analysis</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="trends.html">Dog bite incidence trends</a>
    </li>
    <li>
      <a href="correlation.html">Spatial correlations</a>
    </li>
    <li>
      <a href="regression.html">Modeling dog bite incidences</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://zhenkunnfang.shinyapps.io/shiny_app-1/">Shiny</a>
</li>
<li>
  <a href="https://www.youtube.com/">
    <span class="fa fa-youtube-play"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/joielizeqi/p8105_final.github.io.git">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Cumulative impact of various factors on dog
bite incidents</h1>

</div>


<div id="variable-features" class="section level1">
<h1>Variable features</h1>
<p>回归使用zipcode中累积的dogbite数量为因变量。</p>
</div>
<div id="negative-binomial-regression-analysis" class="section level1">
<h1>Negative Binomial Regression Analysis</h1>
<p>To measure the combined effects of year, dog background
characteristics (i.e., gender and whether neutered) and the Borough they
belong to on the incidence of dog bites, we first conduct a negative
binomial regression analysis using records of dog bite incidents in New
York.</p>
<p>The negative binomial regression model is a type of count model
designed for dependent variables that can only take non-negative integer
values. From the Spatial Correlations section, the study area meets the
three prerequisites for negative binomial regression: the dog bite
incidents are not independent, exhibiting spatial clustering; the
dependent variable shows overdispersion; and the frequency of dog bite
incidents is sufficiently low.</p>
<p>The dependent variable hypothesized in the article is the number of
dog bite incidents per zipcode, which follows a negative binomial
distribution. The predictor variables include the year and month of the
incident, characteristics of the dog, and the area where the incident
occurred. The year is measured as an interval-level variable, with
values from 1 (corresponding to 2015) to 7 (corresponding to 2021). The
area of the incident is divided into variables ranging from 1 to 5,
representing the five boroughs of New York City. The gender of the dog
is a binary variable, with 1 indicating female and 2 indicating male.
Similarly, the sterilization status of the dog is also a binary
variable, with 0 indicating unsterilized and 1 indicating sterilized.
The model equation is as follows:</p>
<p><span class="math display">\[\ln ({\hat y_i}) = {\beta _0} + {\beta
_1}{X_{i1}} + {\beta _2}{X_{i2}} +  \cdots {\beta _m}{X_{im}} +
\xi\]</span> Here, <span class="math inline">\({y_i}\)</span> represents
the frequency of dog bite incidents within a year, <span
class="math inline">\({\beta _m}\)</span> is the coefficient, <span
class="math inline">\(X_m\)</span> are the explanatory variables, and
<span class="math inline">\(\xi\)</span> represents the heterogeneity
across observations.</p>
<p>In negative binomial regression, where the conditional expectation
<span class="math inline">\(E(Y|X) = {e^{{\beta _0} + {\beta _1}{X_{i1}}
+ {\beta _2}{X_{i2}} +  \cdots {\beta _m}{X_{im}}}}\)</span>, the
interpretation of the model’s coefficients is as follows: when the
explanatory variable <span class="math inline">\({X_k}\)</span>
increases by one unit, the average occurrence rate of dog bite incidents
becomes <span class="math inline">\({e^{{\beta _k}}}\)</span> times what
it was originally.</p>
<p><span class="math display">\[\frac{{E(Y|{X^*})}}{{E(Y|X)}} =
\frac{{{e^{{\beta _0} + {\beta _1}{X_{i1}} +  \cdots  + {\beta
_k}({X_{ik}} + 1) +  \cdots  + {\beta _m}{X_{im}}}}}}{{{e^{{\beta _0} +
{\beta _1}{X_{i1}} +  \cdots  + {\beta _k}{X_{ik}} +  \cdots  + {\beta
_m}{X_{im}}}}}} = {e^{{\beta _k}}}\]</span></p>
<div id="original-model" class="section level3">
<h3>Original Model</h3>
<pre class="r"><code>library(MASS)</code></pre>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:plotly&#39;:
## 
##     select</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<pre class="r"><code>dog_bites_filtered = dog_bites_clean %&gt;%
  filter(gender != &quot;U&quot;,
         zip_code %in% valid_zipcodes,
         borough != &quot;Other&quot;) %&gt;%
  mutate(
    gender = factor(gender),
    spay_neuter = factor(spay_neuter, levels = c(FALSE, TRUE), labels = c(&quot;Not Neutered&quot;, &quot;Neutered&quot;)),
    borough = factor(borough),
    year = factor(year),
    month = factor(month)
  )

bites_by_group = dog_bites_filtered %&gt;%
  count(year, month, gender, spay_neuter, borough, name = &quot;bite_count&quot;)

model = glm.nb(bite_count ~ year + month + gender + spay_neuter + borough, data = bites_by_group)

summary(model)</code></pre>
<pre><code>## 
## Call:
## glm.nb(formula = bite_count ~ year + month + gender + spay_neuter + 
##     borough, data = bites_by_group, init.theta = 25.18281019, 
##     link = log)
## 
## Coefficients:
##                      Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)           1.08198    0.05946  18.198  &lt; 2e-16 ***
## year2016              0.06974    0.04157   1.678 0.093442 .  
## year2017              0.15356    0.04091   3.754 0.000174 ***
## year2018              0.07524    0.04154   1.811 0.070080 .  
## year2019              0.09421    0.04138   2.276 0.022824 *  
## year2020             -0.27913    0.04543  -6.145 8.01e-10 ***
## year2021             -0.28710    0.04588  -6.258 3.91e-10 ***
## month2                0.00253    0.05872   0.043 0.965638    
## month3                0.02998    0.05823   0.515 0.606714    
## month4                0.12748    0.05712   2.232 0.025620 *  
## month5                0.18071    0.05658   3.194 0.001404 ** 
## month6                0.24480    0.05597   4.374 1.22e-05 ***
## month7                0.20194    0.05655   3.571 0.000355 ***
## month8                0.22764    0.05635   4.040 5.35e-05 ***
## month9                0.14295    0.05710   2.503 0.012297 *  
## month10               0.09120    0.05777   1.579 0.114408    
## month11               0.08889    0.05772   1.540 0.123580    
## month12               0.01850    0.05886   0.314 0.753242    
## genderM               0.88512    0.02452  36.097  &lt; 2e-16 ***
## spay_neuterNeutered  -0.11228    0.02283  -4.918 8.76e-07 ***
## boroughBrooklyn       0.30511    0.03611   8.449  &lt; 2e-16 ***
## boroughManhattan      0.23766    0.03651   6.509 7.57e-11 ***
## boroughQueens         0.49818    0.03497  14.246  &lt; 2e-16 ***
## boroughStaten Island -0.55175    0.04468 -12.350  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Negative Binomial(25.1828) family taken to be 1)
## 
##     Null deviance: 3914.5  on 1572  degrees of freedom
## Residual deviance: 1549.7  on 1549  degrees of freedom
## AIC: 7403.4
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  25.18 
##           Std. Err.:  4.28 
## 
##  2 x log-likelihood:  -7353.42</code></pre>
</div>
<div id="with-interaction" class="section level3">
<h3>With Interaction</h3>
<<<<<<< HEAD
<p>To further increase the precision of the model fit, interaction terms
between variables were added. After using stepwise reduction to simplify
the model complexity, the final Negative Binomial Regression model is as
follows:</p>
<pre class="r"><code>model_all_interactions &lt;- glm.nb(
  formula = bite_count ~ 
    year + month + gender + spay_neuter + borough +
    year * month + year * gender + year * spay_neuter + year * borough +
    month * gender + month * spay_neuter + month * borough +
    gender * spay_neuter + gender * borough + spay_neuter * borough +
    year * month * gender + year * month * spay_neuter + year * month * borough + 
    year * gender * spay_neuter + year * gender * borough + year * spay_neuter * borough +
    month * gender * spay_neuter + month * gender * borough + month * spay_neuter * borough +
    gender * spay_neuter * borough +
    year * month * gender * spay_neuter + year * month * gender * borough +
    year * month * spay_neuter * borough + year * gender * spay_neuter * borough +
    month * gender * spay_neuter * borough,
  data = bites_by_group
)

model_stepwise &lt;- stepAIC(model_all_interactions, direction = &quot;both&quot;)</code></pre>
<pre><code>## Start:  AIC=8389.27
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year * month + year * gender + year * spay_neuter + year * 
##     borough + month * gender + month * spay_neuter + month * 
##     borough + gender * spay_neuter + gender * borough + spay_neuter * 
##     borough + year * month * gender + year * month * spay_neuter + 
##     year * month * borough + year * gender * spay_neuter + year * 
##     gender * borough + year * spay_neuter * borough + month * 
##     gender * spay_neuter + month * gender * borough + month * 
##     spay_neuter * borough + gender * spay_neuter * borough + 
##     year * month * gender * spay_neuter + year * month * gender * 
##     borough + year * month * spay_neuter * borough + year * gender * 
##     spay_neuter * borough + month * gender * spay_neuter * borough</code></pre>
<pre><code>##                                     Df    AIC
## - year:month:spay_neuter:borough   254 8071.1
## - year:month:gender:borough        249 8090.4
## - year:month:gender:spay_neuter     66 8320.2
## - month:gender:spay_neuter:borough  44 8346.1
## - year:gender:spay_neuter:borough   24 8357.8
## &lt;none&gt;                                 8389.3</code></pre>
<pre><code>## 
## Step:  AIC=8071.05
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + month:borough + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough + year:month:gender + 
##     year:month:spay_neuter + year:month:borough + year:gender:spay_neuter + 
##     year:gender:borough + year:spay_neuter:borough + month:gender:spay_neuter + 
##     month:gender:borough + month:spay_neuter:borough + gender:spay_neuter:borough + 
##     year:month:gender:spay_neuter + year:month:gender:borough + 
##     year:gender:spay_neuter:borough + month:gender:spay_neuter:borough</code></pre>
<pre><code>##                                     Df    AIC
## - year:month:gender:borough        250 7774.1
## - year:month:gender:spay_neuter     66 8002.2
## - month:gender:spay_neuter:borough  44 8026.8
## - year:gender:spay_neuter:borough   24 8039.3
## &lt;none&gt;                                 8071.1
## + year:month:spay_neuter:borough   254 8389.3</code></pre>
<pre><code>## 
## Step:  AIC=7774.08
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + month:borough + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough + year:month:gender + 
##     year:month:spay_neuter + year:month:borough + year:gender:spay_neuter + 
##     year:gender:borough + year:spay_neuter:borough + month:gender:spay_neuter + 
##     month:gender:borough + month:spay_neuter:borough + gender:spay_neuter:borough + 
##     year:month:gender:spay_neuter + year:gender:spay_neuter:borough + 
##     month:gender:spay_neuter:borough</code></pre>
<pre><code>##                                     Df    AIC
## - year:month:borough               263 7512.8
## - year:month:gender:spay_neuter     66 7706.9
## - month:gender:spay_neuter:borough  44 7729.7
## - year:gender:spay_neuter:borough   24 7746.2
## &lt;none&gt;                                 7774.1
## + year:month:gender:borough        250 8071.1
## + year:month:spay_neuter:borough   255 8090.4</code></pre>
<pre><code>## 
## Step:  AIC=7512.75
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + month:borough + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough + year:month:gender + 
##     year:month:spay_neuter + year:gender:spay_neuter + year:gender:borough + 
##     year:spay_neuter:borough + month:gender:spay_neuter + month:gender:borough + 
##     month:spay_neuter:borough + gender:spay_neuter:borough + 
##     year:month:gender:spay_neuter + year:gender:spay_neuter:borough + 
##     month:gender:spay_neuter:borough</code></pre>
<pre><code>##                                     Df    AIC
## - year:month:gender:spay_neuter     66 7443.2
## - month:gender:spay_neuter:borough  44 7465.5
## - year:gender:spay_neuter:borough   24 7485.2
## &lt;none&gt;                                 7512.8
## + year:month:borough               263 7774.1</code></pre>
<pre><code>## 
## Step:  AIC=7443.17
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + month:borough + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough + year:month:gender + 
##     year:month:spay_neuter + year:gender:spay_neuter + year:gender:borough + 
##     year:spay_neuter:borough + month:gender:spay_neuter + month:gender:borough + 
##     month:spay_neuter:borough + gender:spay_neuter:borough + 
##     year:gender:spay_neuter:borough + month:gender:spay_neuter:borough</code></pre>
<pre><code>##                                     Df    AIC
## - year:month:gender                 66 7374.4
## - year:month:spay_neuter            66 7389.4
## - month:gender:spay_neuter:borough  44 7397.2
## - year:gender:spay_neuter:borough   24 7416.8
## &lt;none&gt;                                 7443.2
## + year:month:gender:spay_neuter     66 7512.8
## + year:month:borough               263 7706.9</code></pre>
<pre><code>## 
## Step:  AIC=7374.41
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + month:borough + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough + year:month:spay_neuter + 
##     year:gender:spay_neuter + year:gender:borough + year:spay_neuter:borough + 
##     month:gender:spay_neuter + month:gender:borough + month:spay_neuter:borough + 
##     gender:spay_neuter:borough + year:gender:spay_neuter:borough + 
##     month:gender:spay_neuter:borough</code></pre>
<pre><code>##                                     Df    AIC
## - year:month:spay_neuter            66 7319.9
## - month:gender:spay_neuter:borough  44 7327.4
## - year:gender:spay_neuter:borough   24 7346.7
## &lt;none&gt;                                 7374.4
## + year:month:gender                 66 7443.2
## + year:month:borough               263 7635.4</code></pre>
<pre><code>## 
## Step:  AIC=7319.95
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + month:borough + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough + year:gender:spay_neuter + 
##     year:gender:borough + year:spay_neuter:borough + month:gender:spay_neuter + 
##     month:gender:borough + month:spay_neuter:borough + gender:spay_neuter:borough + 
##     year:gender:spay_neuter:borough + month:gender:spay_neuter:borough</code></pre>
<pre><code>##                                     Df    AIC
## - month:gender:spay_neuter:borough  44 7273.5
## - year:gender:spay_neuter:borough   24 7292.6
## &lt;none&gt;                                 7319.9
## - year:month                        66 7320.7
## + year:month:spay_neuter            66 7374.4
## + year:month:gender                 66 7389.4
## + year:month:borough               263 7579.6</code></pre>
<pre><code>## 
## Step:  AIC=7273.52
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + month:borough + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough + year:gender:spay_neuter + 
##     year:gender:borough + year:spay_neuter:borough + month:gender:spay_neuter + 
##     month:gender:borough + month:spay_neuter:borough + gender:spay_neuter:borough + 
##     year:gender:spay_neuter:borough</code></pre>
<pre><code>##                                     Df    AIC
## - month:gender:borough              44 7220.9
## - month:spay_neuter:borough         44 7234.1
## - year:gender:spay_neuter:borough   24 7245.4
## - month:gender:spay_neuter          11 7261.1
## - year:month                        66 7273.2
## &lt;none&gt;                                 7273.5
## + month:gender:spay_neuter:borough  44 7319.9
## + year:month:spay_neuter            66 7327.4
## + year:month:gender                 66 7344.0
## + year:month:borough               263 7534.6</code></pre>
<pre><code>## 
## Step:  AIC=7220.93
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + month:borough + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough + year:gender:spay_neuter + 
##     year:gender:borough + year:spay_neuter:borough + month:gender:spay_neuter + 
##     month:spay_neuter:borough + gender:spay_neuter:borough + 
##     year:gender:spay_neuter:borough</code></pre>
<pre><code>##                                    Df    AIC
## - month:spay_neuter:borough        44 7181.9
## - year:gender:spay_neuter:borough  24 7193.6
## - month:gender:spay_neuter         11 7208.8
## - year:month                       66 7219.8
## &lt;none&gt;                                7220.9
## + month:gender:borough             44 7273.5
## + year:month:spay_neuter           66 7274.7
## + year:month:gender                66 7290.7
## + year:month:borough              263 7481.4</code></pre>
<pre><code>## 
## Step:  AIC=7181.87
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + month:borough + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough + year:gender:spay_neuter + 
##     year:gender:borough + year:spay_neuter:borough + month:gender:spay_neuter + 
##     gender:spay_neuter:borough + year:gender:spay_neuter:borough</code></pre>
<pre><code>##                                    Df    AIC
## - year:gender:spay_neuter:borough  24 7153.9
## - month:borough                    44 7156.3
## - month:gender:spay_neuter         11 7169.8
## - year:month                       66 7181.0
## &lt;none&gt;                                7181.9
## + month:spay_neuter:borough        44 7220.9
## + month:gender:borough             44 7234.1
## + year:month:spay_neuter           66 7234.7
## + year:month:gender                66 7252.6
## + year:month:borough              263 7437.9</code></pre>
<pre><code>## 
## Step:  AIC=7153.94
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + month:borough + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough + year:gender:spay_neuter + 
##     year:gender:borough + year:spay_neuter:borough + month:gender:spay_neuter + 
##     gender:spay_neuter:borough</code></pre>
<pre><code>##                                    Df    AIC
## - month:borough                    44 7128.6
## - year:gender:borough              24 7132.6
## - year:spay_neuter:borough         24 7142.0
## - month:gender:spay_neuter         11 7142.1
## - year:gender:spay_neuter           6 7146.2
## - gender:spay_neuter:borough        4 7147.8
## - year:month                       66 7152.8
## &lt;none&gt;                                7153.9
## + year:gender:spay_neuter:borough  24 7181.9
## + month:spay_neuter:borough        44 7193.6
## + month:gender:borough             44 7205.4
## + year:month:spay_neuter           66 7206.8
## + year:month:gender                66 7225.6
## + year:month:borough              263 7409.6</code></pre>
<pre><code>## 
## Step:  AIC=7128.6
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + gender:spay_neuter + gender:borough + 
##     spay_neuter:borough + year:gender:spay_neuter + year:gender:borough + 
##     year:spay_neuter:borough + month:gender:spay_neuter + gender:spay_neuter:borough</code></pre>
<pre><code>##                                   Df    AIC
## - year:gender:borough             24 7106.9
## - year:spay_neuter:borough        24 7116.5
## - month:gender:spay_neuter        11 7116.7
## - year:gender:spay_neuter          6 7121.0
## - gender:spay_neuter:borough       4 7122.6
## - year:month                      66 7126.9
## &lt;none&gt;                               7128.6
## + month:borough                   44 7153.9
## + year:gender:spay_neuter:borough 24 7156.3
## + year:month:spay_neuter          66 7181.6
## + year:month:gender               66 7199.5</code></pre>
<pre><code>## 
## Step:  AIC=7106.86
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + gender:spay_neuter + gender:borough + 
##     spay_neuter:borough + year:gender:spay_neuter + year:spay_neuter:borough + 
##     month:gender:spay_neuter + gender:spay_neuter:borough</code></pre>
<pre><code>##                              Df    AIC
## - year:spay_neuter:borough   24 7094.6
## - month:gender:spay_neuter   11 7094.7
## - year:gender:spay_neuter     6 7098.1
## - gender:spay_neuter:borough  4 7100.5
## - year:month                 66 7105.2
## &lt;none&gt;                          7106.9
## + year:gender:borough        24 7128.6
## + month:borough              44 7132.6
## + year:month:spay_neuter     66 7159.9
## + year:month:gender          66 7177.9</code></pre>
<pre><code>## 
## Step:  AIC=7094.63
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + gender:spay_neuter + gender:borough + 
##     spay_neuter:borough + year:gender:spay_neuter + month:gender:spay_neuter + 
##     gender:spay_neuter:borough</code></pre>
<pre><code>##                              Df    AIC
## - month:gender:spay_neuter   11 7082.5
## - year:gender:spay_neuter     6 7086.0
## - gender:spay_neuter:borough  4 7088.2
## - year:month                 66 7092.7
## &lt;none&gt;                          7094.6
## + year:spay_neuter:borough   24 7106.9
## + year:gender:borough        24 7116.5
## + month:borough              44 7120.6
## - year:borough               24 7137.0
## + year:month:spay_neuter     66 7147.5
## + year:month:gender          66 7165.9</code></pre>
<pre><code>## 
## Step:  AIC=7082.51
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:gender + month:spay_neuter + gender:spay_neuter + gender:borough + 
##     spay_neuter:borough + year:gender:spay_neuter + gender:spay_neuter:borough</code></pre>
<pre><code>##                              Df    AIC
## - month:gender               11 7064.9
## - year:gender:spay_neuter     6 7073.8
## - gender:spay_neuter:borough  4 7076.0
## - year:month                 66 7080.4
## - month:spay_neuter          11 7082.4
## &lt;none&gt;                          7082.5
## + month:gender:spay_neuter   11 7094.6
## + year:spay_neuter:borough   24 7094.7
## + year:gender:borough        24 7104.6
## + month:borough              44 7108.6
## - year:borough               24 7125.3
## + year:month:spay_neuter     66 7136.1
## + year:month:gender          66 7153.0</code></pre>
<pre><code>## 
## Step:  AIC=7064.92
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:spay_neuter + gender:spay_neuter + gender:borough + 
##     spay_neuter:borough + year:gender:spay_neuter + gender:spay_neuter:borough</code></pre>
<pre><code>##                              Df    AIC
## - year:gender:spay_neuter     6 7056.2
## - gender:spay_neuter:borough  4 7058.4
## - year:month                 66 7062.9
## &lt;none&gt;                          7064.9
## - month:spay_neuter          11 7065.0
## + year:spay_neuter:borough   24 7077.0
## + month:gender               11 7082.5
## + year:gender:borough        24 7086.9
## + month:borough              44 7091.0
## - year:borough               24 7107.9
## + year:month:spay_neuter     66 7118.8</code></pre>
<pre><code>## 
## Step:  AIC=7056.21
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:spay_neuter + gender:spay_neuter + gender:borough + 
##     spay_neuter:borough + gender:spay_neuter:borough</code></pre>
<pre><code>##                              Df    AIC
## - gender:spay_neuter:borough  4 7049.7
## - year:gender                 6 7052.2
## - year:month                 66 7054.2
## &lt;none&gt;                          7056.2
## - month:spay_neuter          11 7056.3
## + year:gender:spay_neuter     6 7064.9
## + year:spay_neuter:borough   24 7068.1
## + month:gender               11 7073.8
## + year:gender:borough        24 7079.2
## + month:borough              44 7082.3
## - year:borough               24 7099.3
## - year:spay_neuter            6 7107.2
## + year:month:spay_neuter     66 7110.1</code></pre>
<pre><code>## 
## Step:  AIC=7049.72
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:gender + year:spay_neuter + year:borough + 
##     month:spay_neuter + gender:spay_neuter + gender:borough + 
##     spay_neuter:borough</code></pre>
<pre><code>##                              Df    AIC
## - year:gender                 6 7045.7
## - year:month                 66 7047.8
## &lt;none&gt;                          7049.7
## - month:spay_neuter          11 7049.8
## + gender:spay_neuter:borough  4 7056.2
## - gender:spay_neuter          1 7056.5
## - gender:borough              4 7057.3
## + year:gender:spay_neuter     6 7058.4
## + year:spay_neuter:borough   24 7061.7
## + month:gender               11 7067.3
## + year:gender:borough        24 7072.7
## + month:borough              44 7075.7
## - year:borough               24 7093.0
## - year:spay_neuter            6 7100.9
## + year:month:spay_neuter     66 7103.7
## - spay_neuter:borough         4 7364.3</code></pre>
<pre><code>## 
## Step:  AIC=7045.75
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:month + year:spay_neuter + year:borough + month:spay_neuter + 
##     gender:spay_neuter + gender:borough + spay_neuter:borough</code></pre>
<pre><code>##                              Df    AIC
## - year:month                 66 7043.8
## &lt;none&gt;                          7045.7
## - month:spay_neuter          11 7045.8
## + year:gender                 6 7049.7
## - gender:spay_neuter          1 7051.7
## - gender:borough              4 7051.9
## + gender:spay_neuter:borough  4 7052.2
## + year:spay_neuter:borough   24 7057.5
## + month:gender               11 7063.4
## + month:borough              44 7071.7
## - year:borough               24 7089.4
## - year:spay_neuter            6 7096.1
## + year:month:spay_neuter     66 7099.7
## - spay_neuter:borough         4 7360.7</code></pre>
<pre><code>## 
## Step:  AIC=7043.76
## bite_count ~ year + month + gender + spay_neuter + borough + 
##     year:spay_neuter + year:borough + month:spay_neuter + gender:spay_neuter + 
##     gender:borough + spay_neuter:borough</code></pre>
<pre><code>##                              Df    AIC
## &lt;none&gt;                          7043.8
## + year:month                 66 7045.7
## - month:spay_neuter          11 7047.1
## + year:gender                 6 7047.8
## - gender:spay_neuter          1 7049.7
## - gender:borough              4 7049.9
## + gender:spay_neuter:borough  4 7050.2
## + year:spay_neuter:borough   24 7055.9
## + month:gender               11 7061.2
## + month:borough              44 7070.3
## - year:borough               24 7084.8
## - year:spay_neuter            6 7096.0
## - spay_neuter:borough         4 7340.9</code></pre>
=======
>>>>>>> 2b57a62d9781ec3e19e243ab8f8d1db467e3fe19
<pre class="r"><code>filter_model = glm.nb(bite_count ~ year + month + gender + spay_neuter + 
    borough + year:spay_neuter + year:borough + month:spay_neuter + 
    gender:spay_neuter + gender:borough + spay_neuter:borough, 
    data = bites_by_group)</code></pre>
<pre><code>## Warning in theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace =
## control$trace &gt; : iteration limit reached
## Warning in theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace =
## control$trace &gt; : iteration limit reached</code></pre>
<pre class="r"><code>summary(filter_model)</code></pre>
<pre><code>## 
## Call:
## glm.nb(formula = bite_count ~ year + month + gender + spay_neuter + 
##     borough + year:spay_neuter + year:borough + month:spay_neuter + 
##     gender:spay_neuter + gender:borough + spay_neuter:borough, 
##     data = bites_by_group, init.theta = 35483.47117, link = log)
## 
## Coefficients:
##                                           Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)                               1.341982   0.091715  14.632  &lt; 2e-16
## year2016                                  0.264946   0.090104   2.940 0.003277
## year2017                                  0.129712   0.092290   1.405 0.159878
## year2018                                  0.271432   0.090817   2.989 0.002801
## year2019                                  0.271740   0.090544   3.001 0.002689
## year2020                                 -0.194931   0.104705  -1.862 0.062642
## year2021                                 -0.215686   0.107294  -2.010 0.044406
## month2                                   -0.027454   0.069567  -0.395 0.693106
## month3                                    0.010489   0.068496   0.153 0.878294
## month4                                   -0.006620   0.068491  -0.097 0.922998
## month5                                    0.065807   0.067283   0.978 0.328038
## month6                                    0.156214   0.065759   2.376 0.017522
## month7                                    0.190514   0.065407   2.913 0.003582
## month8                                    0.140605   0.066486   2.115 0.034448
## month9                                    0.032965   0.068063   0.484 0.628152
## month10                                   0.091623   0.067365   1.360 0.173794
## month11                                   0.017673   0.068307   0.259 0.795847
## month12                                  -0.012775   0.068906  -0.185 0.852919
## genderM                                   0.858813   0.054618  15.724  &lt; 2e-16
## spay_neuterNeutered                      -0.926300   0.109048  -8.494  &lt; 2e-16
## boroughBrooklyn                           0.138429   0.100729   1.374 0.169360
## boroughManhattan                         -0.330011   0.108318  -3.047 0.002314
## boroughQueens                             0.005221   0.100485   0.052 0.958560
## boroughStaten Island                     -0.735464   0.129502  -5.679 1.35e-08
## year2016:spay_neuterNeutered              0.059432   0.073885   0.804 0.421172
## year2017:spay_neuterNeutered              0.118824   0.072212   1.645 0.099869
## year2018:spay_neuterNeutered             -0.178941   0.073824  -2.424 0.015355
## year2019:spay_neuterNeutered             -0.105464   0.073298  -1.439 0.150195
## year2020:spay_neuterNeutered             -0.343394   0.083263  -4.124 3.72e-05
## year2021:spay_neuterNeutered             -0.351875   0.084249  -4.177 2.96e-05
## year2016:boroughBrooklyn                 -0.401051   0.113611  -3.530 0.000416
## year2017:boroughBrooklyn                 -0.221060   0.114629  -1.928 0.053795
## year2018:boroughBrooklyn                 -0.485118   0.116810  -4.153 3.28e-05
## year2019:boroughBrooklyn                 -0.441569   0.115885  -3.810 0.000139
## year2020:boroughBrooklyn                 -0.084009   0.130890  -0.642 0.520983
## year2021:boroughBrooklyn                 -0.086726   0.134072  -0.647 0.517722
## year2016:boroughManhattan                -0.265007   0.121969  -2.173 0.029800
## year2017:boroughManhattan                 0.005676   0.121403   0.047 0.962707
## year2018:boroughManhattan                 0.073638   0.120001   0.614 0.539453
## year2019:boroughManhattan                 0.036786   0.119708   0.307 0.758616
## year2020:boroughManhattan                 0.276769   0.136570   2.027 0.042706
## year2021:boroughManhattan                 0.216915   0.139749   1.552 0.120621
## year2016:boroughQueens                   -0.205677   0.113647  -1.810 0.070329
## year2017:boroughQueens                    0.083213   0.113586   0.733 0.463805
## year2018:boroughQueens                    0.043839   0.113139   0.387 0.698403
## year2019:boroughQueens                    0.021763   0.112744   0.193 0.846939
## year2020:boroughQueens                    0.118833   0.130621   0.910 0.362951
## year2021:boroughQueens                    0.255885   0.131547   1.945 0.051750
## year2016:boroughStaten Island            -0.145628   0.143157  -1.017 0.309031
## year2017:boroughStaten Island            -0.013484   0.142522  -0.095 0.924627
## year2018:boroughStaten Island            -0.183792   0.148307  -1.239 0.215246
## year2019:boroughStaten Island            -0.241500   0.146806  -1.645 0.099964
## year2020:boroughStaten Island            -0.115257   0.178990  -0.644 0.519622
## year2021:boroughStaten Island            -0.327040   0.192923  -1.695 0.090040
## month2:spay_neuterNeutered                0.093060   0.104601   0.890 0.373646
## month3:spay_neuterNeutered                0.057360   0.103859   0.552 0.580754
## month4:spay_neuterNeutered                0.304865   0.101057   3.017 0.002555
## month5:spay_neuterNeutered                0.267348   0.099878   2.677 0.007434
## month6:spay_neuterNeutered                0.221396   0.098430   2.249 0.024495
## month7:spay_neuterNeutered                0.053891   0.099843   0.540 0.589366
## month8:spay_neuterNeutered                0.204595   0.099156   2.063 0.039077
## month9:spay_neuterNeutered                0.251572   0.100921   2.493 0.012676
## month10:spay_neuterNeutered               0.021214   0.102592   0.207 0.836178
## month11:spay_neuterNeutered               0.158559   0.102491   1.547 0.121848
## month12:spay_neuterNeutered               0.077373   0.104968   0.737 0.461056
## genderM:spay_neuterNeutered              -0.127791   0.045308  -2.820 0.004795
## genderM:boroughBrooklyn                   0.158718   0.071433   2.222 0.026289
## genderM:boroughManhattan                  0.124864   0.072546   1.721 0.085221
## genderM:boroughQueens                     0.156415   0.068417   2.286 0.022243
## genderM:boroughStaten Island             -0.097614   0.091720  -1.064 0.287213
## spay_neuterNeutered:boroughBrooklyn       0.898637   0.069394  12.950  &lt; 2e-16
## spay_neuterNeutered:boroughManhattan      1.144141   0.070459  16.238  &lt; 2e-16
## spay_neuterNeutered:boroughQueens         0.975707   0.067006  14.561  &lt; 2e-16
## spay_neuterNeutered:boroughStaten Island  1.009285   0.086896  11.615  &lt; 2e-16
##                                             
## (Intercept)                              ***
## year2016                                 ** 
## year2017                                    
## year2018                                 ** 
## year2019                                 ** 
## year2020                                 .  
## year2021                                 *  
## month2                                      
## month3                                      
## month4                                      
## month5                                      
## month6                                   *  
## month7                                   ** 
## month8                                   *  
## month9                                      
## month10                                     
## month11                                     
## month12                                     
## genderM                                  ***
## spay_neuterNeutered                      ***
## boroughBrooklyn                             
## boroughManhattan                         ** 
## boroughQueens                               
## boroughStaten Island                     ***
## year2016:spay_neuterNeutered                
## year2017:spay_neuterNeutered             .  
## year2018:spay_neuterNeutered             *  
## year2019:spay_neuterNeutered                
## year2020:spay_neuterNeutered             ***
## year2021:spay_neuterNeutered             ***
## year2016:boroughBrooklyn                 ***
## year2017:boroughBrooklyn                 .  
## year2018:boroughBrooklyn                 ***
## year2019:boroughBrooklyn                 ***
## year2020:boroughBrooklyn                    
## year2021:boroughBrooklyn                    
## year2016:boroughManhattan                *  
## year2017:boroughManhattan                   
## year2018:boroughManhattan                   
## year2019:boroughManhattan                   
## year2020:boroughManhattan                *  
## year2021:boroughManhattan                   
## year2016:boroughQueens                   .  
## year2017:boroughQueens                      
## year2018:boroughQueens                      
## year2019:boroughQueens                      
## year2020:boroughQueens                      
## year2021:boroughQueens                   .  
## year2016:boroughStaten Island               
## year2017:boroughStaten Island               
## year2018:boroughStaten Island               
## year2019:boroughStaten Island            .  
## year2020:boroughStaten Island               
## year2021:boroughStaten Island            .  
## month2:spay_neuterNeutered                  
## month3:spay_neuterNeutered                  
## month4:spay_neuterNeutered               ** 
## month5:spay_neuterNeutered               ** 
## month6:spay_neuterNeutered               *  
## month7:spay_neuterNeutered                  
## month8:spay_neuterNeutered               *  
## month9:spay_neuterNeutered               *  
## month10:spay_neuterNeutered                 
## month11:spay_neuterNeutered                 
## month12:spay_neuterNeutered                 
## genderM:spay_neuterNeutered              ** 
## genderM:boroughBrooklyn                  *  
## genderM:boroughManhattan                 .  
## genderM:boroughQueens                    *  
## genderM:boroughStaten Island                
## spay_neuterNeutered:boroughBrooklyn      ***
## spay_neuterNeutered:boroughManhattan     ***
## spay_neuterNeutered:boroughQueens        ***
## spay_neuterNeutered:boroughStaten Island ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Negative Binomial(35483.47) family taken to be 1)
## 
##     Null deviance: 4944.9  on 1572  degrees of freedom
## Residual deviance: 1437.1  on 1499  degrees of freedom
## AIC: 7045.8
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  35483 
##           Std. Err.:  232188 
## Warning while fitting theta: iteration limit reached 
## 
##  2 x log-likelihood:  -6895.762</code></pre>
</div>
<div id="model-evaluation" class="section level3">
<h3>Model evaluation</h3>
<pre class="r"><code># Predicted vs Actual Bite Count
inter_predict = bites_by_group |&gt; 
  mutate(predicted = predict(model_stepwise, type = &quot;response&quot;))

ggplot(inter_predict, aes(x = predicted, y = bite_count)) +
  geom_point(alpha = 0.5) +
  geom_abline(slope = 1, intercept = 0, color = &quot;red&quot;, linetype = &quot;dashed&quot;) +
  labs(title = &quot;Predicted vs. Actual Bite Count&quot;,
       x = &quot;Predicted Bite Count&quot;,
       y = &quot;Actual Bite Count&quot;) +
  theme_minimal()</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>library(DHARMa)</code></pre>
<pre><code>## This is DHARMa 0.4.7. For overview type &#39;?DHARMa&#39;. For recent changes, type news(package = &#39;DHARMa&#39;)</code></pre>
<pre class="r"><code>residuals_sim = simulateResiduals(model_stepwise)
plot(model_stepwise)</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-7-1.png" width="672" /><img src="regression_files/figure-html/unnamed-chunk-7-2.png" width="672" /><img src="regression_files/figure-html/unnamed-chunk-7-3.png" width="672" /><img src="regression_files/figure-html/unnamed-chunk-7-4.png" width="672" /></p>
</div>
</div>
<div id="regularized-model-lasso" class="section level1">
<h1>Regularized Model (Lasso)</h1>
<pre class="r"><code># lasso
library(glmnet)</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: &#39;Matrix&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, pack, unpack</code></pre>
<pre><code>## Loaded glmnet 4.1-8</code></pre>
<pre class="r"><code># 将数据转换为矩阵
x = model.matrix(bite_count ~ year + month + gender + spay_neuter + borough, data = bites_by_group)
y = bites_by_group |&gt; pull(bite_count)

# Lasso 回归
cv_model = cv.glmnet(x, y, family = &quot;poisson&quot;, alpha = 1)  # Lasso：alpha = 1
summary(cv_model)</code></pre>
<pre><code>##            Length Class   Mode     
## lambda     70     -none-  numeric  
## cvm        70     -none-  numeric  
## cvsd       70     -none-  numeric  
## cvup       70     -none-  numeric  
## cvlo       70     -none-  numeric  
## nzero      70     -none-  numeric  
## call        5     -none-  call     
## name        1     -none-  character
## glmnet.fit 12     fishnet list     
## lambda.min  1     -none-  numeric  
## lambda.1se  1     -none-  numeric  
## index       2     -none-  numeric</code></pre>
<pre class="r"><code>cv_results &lt;- data.frame(
  log_lambda = log(cv_model$lambda),
  mean_mse = cv_model$cvm,
  lower_mse = cv_model$cvlo,
  upper_mse = cv_model$cvup
)

best_lambda &lt;- cv_model$lambda.min
log_best_lambda &lt;- log(best_lambda)

ggplot(cv_results, aes(x = log_lambda, y = mean_mse)) +
  geom_line(color = &quot;blue&quot;, size = 1) +
  geom_ribbon(aes(ymin = lower_mse, ymax = upper_mse), alpha = 0.2, fill = &quot;blue&quot;) +
  geom_vline(xintercept = log_best_lambda, linetype = &quot;dashed&quot;, color = &quot;red&quot;) +
  labs(
    title = &quot;Cross-Validation for Lasso Regression&quot;,
    x = &quot;Log(Lambda)&quot;,
    y = &quot;Mean Cross-Validated Error&quot;
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code># 获取模型在最佳 lambda 下的系数
lasso_coefficients &lt;- coef(cv_model, s = &quot;lambda.min&quot;)

# 将系数转换为数据框以便查看
lasso_coefficients_df &lt;- as.data.frame(as.matrix(lasso_coefficients)) %&gt;%
  rownames_to_column(&quot;Variable&quot;) %&gt;%
  rename(Coefficient = 1) %&gt;%
  filter(Coefficient != 0)  # 筛选非零系数的变量

print(lasso_coefficients_df)</code></pre>
<pre><code>##             Coefficient           s1
## 1          X.Intercept.  1.099801956
## 2        X.Intercept..1  0.000000000
## 3              year2016  0.060919855
## 4              year2017  0.149129991
## 5              year2018  0.073152001
## 6              year2019  0.096986077
## 7              year2020 -0.281514521
## 8              year2021 -0.284247504
## 9                month2 -0.013783521
## 10               month3  0.004909783
## 11               month4  0.108573609
## 12               month5  0.161786633
## 13               month6  0.230240597
## 14               month7  0.188210282
## 15               month8  0.210135475
## 16               month9  0.123686574
## 17              month10  0.073065927
## 18              month11  0.063997436
## 19              month12  0.000000000
## 20              genderM  0.888757411
## 21  spay_neuterNeutered -0.104073381
## 22      boroughBrooklyn  0.300860807
## 23     boroughManhattan  0.228158366
## 24        boroughQueens  0.496004768
## 25 boroughStaten.Island -0.557155290</code></pre>
<ul>
<li>使用Lasso回归的结果进行预测</li>
</ul>
<pre class="r"><code>final_model &lt;- glmnet(x, y, family = &quot;poisson&quot;, alpha = 1, lambda = best_lambda)
final_model</code></pre>
<pre><code>## 
## Call:  glmnet(x = x, y = y, family = &quot;poisson&quot;, alpha = 1, lambda = best_lambda) 
## 
##   Df  %Dev   Lambda
## 1 22 60.62 0.004183</code></pre>
<pre class="r"><code>#predictions_lasso &lt;- bites_by_group |&gt; mutate(predicted = predict(final_model, type = &quot;response&quot;))</code></pre>
</div>
<div id="generalized-linear-mixed-model-glmm" class="section level1">
<h1>Generalized Linear Mixed Model (GLMM)</h1>
<p>另一方面，本文进一步使用Generalized Linear Mixed Model
(GLMM)验证所得的回归结果。</p>
<p>The Generalized Linear Mixed Model (GLMM) is an extension of the
Generalized Linear Model (GLM) and the Linear Mixed Model (LMM). GLMM
consists of three main components: random effects, fixed effects, and a
link function. Fixed effects represent the overall level parameters
consistent across all observations, while random effects account for
individual variability or group-level differences that may influence the
response variable. The link function connects the linear predictor to
the mean of the response variable distribution, allowing the dependent
variable to deviate from a normal distribution and enabling modeling of
various types of data, including binary, count, and continuous
outcomes.</p>
<<<<<<< HEAD
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD Let the response variable <span
class="math inline">\(y\)</span> belongs to the exponential family, its
conditional distribution can be expressed as follows:</p>
=======
<p>Let the response variable <span class="math inline">\(y\)</span>
belongs to the exponential family, its conditional distribution can be
expressed as follows:</p>
>>>>>>> 2b57a62d9781ec3e19e243ab8f8d1db467e3fe19
<p><span class="math display">\[f(y|b) = \prod\limits_{i = 1}^n
{f({y_i}|{\eta _i})}\]</span></p>
<p>Where <span class="math inline">\({\eta _i} = {x_i}^ \top \beta  +
{z_i}^ \top b\)</span>. Additionally, the random effect <span
class="math inline">\(b\)</span> is assumed to be distributed according
to <span class="math inline">\(b \sim {\rm N}(0,\Sigma )\)</span>.</p>
<p>Therefore the GLMM is structured as follows:</p>
<p><span class="math display">\[g(\vec {\rm E}(y)) = {\rm X}\vec
\beta  + {\rm Z}\vec b + \varepsilon\]</span></p>
<p>In the model, <span class="math inline">\(g( \cdot )\)</span>
represents the link function, which connects the expected value of the
response variable to the linear predictor. Here, the logarithm function
<span class="math inline">\(g(\mu ) = \ln (\mu )\)</span> is used, which
is appropriate for the Poisson distribution. <span
class="math inline">\(\vec{\mathrm{E}}(y)\)</span> denotes the vector of
expected values for the response variable, and <span
class="math inline">\(\varepsilon\)</span> represents the error term,
capturing random noise or the unexplained variance. <span
class="math inline">\({\rm X}\vec \beta  + {\rm Z}\vec b\)</span>
represents the linear combination of fixed and random effects, <span
class="math inline">\({\rm X}\vec \beta\)</span> is used to explain
global trends, and <span class="math inline">\({\rm Z}\vec b\)</span> is
utilized to capture differences among observations. In this context,
<span class="math inline">\({\rm X}\)</span> is the design matrix for
fixed effects, which is of order <span class="math inline">\(n \times
p\)</span>, where <span class="math inline">\(n\)</span> is the number
of observations and <span class="math inline">\(p\)</span> is the number
of fixed effect variables; <span class="math inline">\(\vec
\beta\)</span> is the vector of coefficients for fixed effects, with
each element representing the regression coefficient of a fixed effect
variable. Similarly, <span class="math inline">\({\rm Z}\)</span> also
serves as the design matrix for random effects, of order <span
class="math inline">\(n \times q\)</span>, where <span
class="math inline">\(q\)</span> is the number of random effect
variables. <span class="math inline">\(\vec b\)</span> is the vector of
coefficients for random effects, representing inter-group deviations
used to explain random differences between groups. The model assumes
<span class="math inline">\(b \sim {\rm N}(0,\Sigma )\)</span>, thereby
the random effects are normally distributed with a mean of <span
class="math inline">\(0\)</span> and a covariance matrix <span
class="math inline">\(\Sigma\)</span>.</p>
<p>对于狗咬伤事件数据集，响应变量<span
class="math inline">\(y\)</span>为每月每zipcode的事件的发生，固定效应包括温度和湿度。随机效应为不同实验员（10
个实验员）。因此，对于所有响应变量，<span class="math inline">\({\rm
X}\)</span>是包含年份，月份，地区，性别，绝育状态的矩阵；<span
class="math inline">\(\vec \beta\)</span>为固定效应系数；<span
class="math inline">\({\rm
X}\)</span>表示每个响应变量所属品种的矩阵；<span
class="math inline">\(\vec
b\)</span>为每个品种的偏差值（随机效应）。</p>
<p>=======</p>
<pre class="r"><code>library(lme4)
glmm_model = glmer.nb(
  bite_count ~ year + month + gender + spay_neuter + (1 | borough), 
  data = bites_by_group
)
summary(glmm_model)</code></pre>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: Negative Binomial(24.7739)  ( log )
## Formula: bite_count ~ year + month + gender + spay_neuter + (1 | borough)
##    Data: bites_by_group
## 
##      AIC      BIC   logLik deviance df.resid 
##   7428.7   7546.6  -3692.3   7384.7     1551 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.2530 -0.7004 -0.1379  0.5946  4.3986 
## 
## Random effects:
##  Groups  Name        Variance Std.Dev.
##  borough (Intercept) 0.1297   0.3601  
## Number of obs: 1573, groups:  borough, 5
## 
## Fixed effects:
##                      Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)          1.180470   0.169990   6.944 3.80e-12 ***
## year2016             0.069806   0.041693   1.674 0.094078 .  
## year2017             0.153529   0.040996   3.745 0.000180 ***
## year2018             0.075276   0.041613   1.809 0.070461 .  
## year2019             0.094144   0.041424   2.273 0.023046 *  
## year2020            -0.278896   0.045542  -6.124 9.13e-10 ***
## year2021            -0.286872   0.045946  -6.244 4.27e-10 ***
## month2               0.002486   0.058860   0.042 0.966308    
## month3               0.029951   0.058422   0.513 0.608178    
## month4               0.127436   0.057261   2.226 0.026045 *  
## month5               0.180650   0.056724   3.185 0.001449 ** 
## month6               0.244655   0.056073   4.363 1.28e-05 ***
## month7               0.201825   0.056635   3.564 0.000366 ***
## month8               0.227603   0.056478   4.030 5.58e-05 ***
## month9               0.142908   0.057234   2.497 0.012529 *  
## month10              0.091132   0.057894   1.574 0.115463    
## month11              0.088932   0.057919   1.535 0.124670    
## month12              0.018502   0.059011   0.314 0.753869    
## genderM              0.884881   0.024565  36.022  &lt; 2e-16 ***
## spay_neuterNeutered -0.112301   0.022910  -4.902 9.50e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="model" class="section level1">
<h1>Model</h1>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>6e0a48bc06a0411fc9c5ffd605c67fd4cbef063b</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
