<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Cumulative impact of various factors on dog bite incidents</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<link href="site_libs/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-5.3.1/bootstrap.bundle.min.js"></script>
<script src="site_libs/bs3compat-0.8.0/transition.js"></script>
<script src="site_libs/bs3compat-0.8.0/tabs.js"></script>
<script src="site_libs/bs3compat-0.8.0/bs3compat.js"></script>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="report.html">Report</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="team.html">Team</a>
    </li>
    <li>
      <a href="datasource.html">Data source</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="eda.html">Exploratory Data Analysis</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="trends.html">Dog bite incidence trends</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Bite-to-license spatial correlation</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="distribution.html">Spatial distribution on NYC map</a>
        </li>
        <li>
          <a href="correlation.html">Spatial correlation using Moran's I</a>
        </li>
      </ul>
    </li>
    <li>
      <a href="regression.html">Modeling dog bite incidences</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://zhenkunnfang.shinyapps.io/shiny_app-1/">Shiny App</a>
</li>
<li>
  <a href="https://www.youtube.com/">
    <span class="fa fa-youtube-play"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/joielizeqi/p8105_final.github.io.git">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Cumulative impact of various factors on dog
bite incidents</h1>

</div>


<div id="variable-features" class="section level1">
<h1>Variable features</h1>
<p>The dependent variable hypothesized in the article is the number of
dog bite incidents per zipcode. The predictor variables include the year
and month of the incident, characteristics of the dog, and the area
where the incident occurred. The year is measured as an interval-level
variable, with values from 1 (corresponding to 2015) to 7 (corresponding
to 2021). The area of the incident is divided into variables ranging
from 1 to 5, representing the five boroughs of New York City. The gender
of the dog is a binary variable, with 1 indicating female and 2
indicating male. Similarly, the sterilization status of the dog is also
a binary variable, with 0 indicating unsterilized and 1 indicating
sterilized.</p>
<pre class="r"><code>data &lt;- data.frame(
  `Variable` = c(&quot;dog_bite_incidents&quot;, &quot;year&quot;, &quot;month&quot;, &quot;gender&quot;, &quot;spay_neuter&quot;, &quot;borough&quot;),
  `Range` = c(
    &quot;$\\mathbb{N}$&quot;,
    &quot;$\\{1, 2, 3, 4, 5, 6, 7\\}$&quot;,
    &quot;$\\{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12\\}$&quot;,
    &quot;$\\{1, 2\\}$&quot;,
    &quot;$\\{0, 1\\}$&quot;,
    &quot;$\\{1, 2, 3, 4, 5\\}$&quot;
  )
)

knitr::kable(data, format = &quot;pipe&quot;, align = &quot;l&quot;, caption = &quot;Variable Implications&quot;)</code></pre>
<table>
<caption>Variable Implications</caption>
<thead>
<tr class="header">
<th align="left">Variable</th>
<th align="left">Range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dog_bite_incidents</td>
<td align="left"><span class="math inline">\(\mathbb{N}\)</span></td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="left"><span class="math inline">\(\{1, 2, 3, 4, 5, 6,
7\}\)</span></td>
</tr>
<tr class="odd">
<td align="left">month</td>
<td align="left"><span class="math inline">\(\{1, 2, 3, 4, 5, 6, 7, 8,
9, 10, 11, 12\}\)</span></td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="left"><span class="math inline">\(\{1, 2\}\)</span></td>
</tr>
<tr class="odd">
<td align="left">spay_neuter</td>
<td align="left"><span class="math inline">\(\{0, 1\}\)</span></td>
</tr>
<tr class="even">
<td align="left">borough</td>
<td align="left"><span class="math inline">\(\{1, 2, 3, 4,
5\}\)</span></td>
</tr>
</tbody>
</table>
</div>
<div id="negative-binomial-regression-analysis" class="section level1">
<h1>Negative Binomial Regression Analysis</h1>
<p>To measure the combined effects of year, dog background
characteristics (i.e., gender and whether neutered) and the Borough they
belong to on the incidence of dog bites, we first conduct a negative
binomial regression analysis using records of dog bite incidents in New
York.</p>
<p>The negative binomial regression model is a type of count model
designed for dependent variables that can only take non-negative integer
values. From the Spatial Correlations section, the study area meets the
three prerequisites for negative binomial regression: the dog bite
incidents are not independent, exhibiting spatial clustering; the
dependent variable shows overdispersion; and the frequency of dog bite
incidents is sufficiently low. Let the dependent variable follows a
negative binomial distribution. The model equation is as follows:</p>
<p><span class="math display">\[\ln ({\hat y_i}) = {\beta _0} + {\beta
_1}{X_{i1}} + {\beta _2}{X_{i2}} +  \cdots {\beta _m}{X_{im}} +
\xi\]</span></p>
<p>Here, <span class="math inline">\({y_i}\)</span> represents the
frequency of dog bite incidents within a year, <span
class="math inline">\({\beta _m}\)</span> is the coefficient, <span
class="math inline">\(X_m\)</span> are the explanatory variables, and
<span class="math inline">\(\xi\)</span> represents the heterogeneity
across observations.</p>
<p>In negative binomial regression, where the conditional expectation
<span class="math inline">\(E(Y|X) = {e^{{\beta _0} + {\beta _1}{X_{i1}}
+ {\beta _2}{X_{i2}} +  \cdots {\beta _m}{X_{im}}}}\)</span>, the
interpretation of the model’s coefficients is as follows: when the
explanatory variable <span class="math inline">\({X_k}\)</span>
increases by one unit, the average occurrence rate of dog bite incidents
becomes <span class="math inline">\({e^{{\beta _k}}}\)</span> times what
it was originally.</p>
<p><span class="math display">\[\frac{{E(Y|{X^*})}}{{E(Y|X)}} =
\frac{{{e^{{\beta _0} + {\beta _1}{X_{i1}} +  \cdots  + {\beta
_k}({X_{ik}} + 1) +  \cdots  + {\beta _m}{X_{im}}}}}}{{{e^{{\beta _0} +
{\beta _1}{X_{i1}} +  \cdots  + {\beta _k}{X_{ik}} +  \cdots  + {\beta
_m}{X_{im}}}}}} = {e^{{\beta _k}}}\]</span></p>
<p>首先，使用lasso筛主变量.</p>
<div id="regularized-model-lasso" class="section level2">
<h2>Regularized Model (Lasso)</h2>
<pre class="r"><code># lasso
library(glmnet)

# 将数据转换为矩阵
x = model.matrix(bite_count ~ year + month + gender + spay_neuter + borough, data = bites_by_group)
y = bites_by_group |&gt; pull(bite_count)

# Lasso 回归
cv_model = cv.glmnet(x, y, family = &quot;poisson&quot;, alpha = 1)  # Lasso：alpha = 1

cv_results &lt;- with(cv_model, 
  data.frame(
  log_lambda = log(lambda),
  mean_mse = cvm,
  lower_mse = cvlo,
  upper_mse = cvup
))</code></pre>
<pre class="r"><code># 确定最佳lambda，
best_lambda &lt;- cv_model$lambda.min
log_best_lambda &lt;- log(best_lambda)</code></pre>
<p>best_lambda：从交叉验证 (cv.glmnet) 。
中找到的使模型误差最小的正则化参数 lambda。0.005529689
log_best_lambda：对最佳 lambda 取对数，用于后续绘图。 目的：lambda
是正则化参数，控制变量选择和模型的稀疏性。找到合适的 lambda
值可以平衡模型复杂度和预测性能。</p>
<pre class="r"><code>ggplot(cv_results, aes(x = log_lambda, y = mean_mse)) +
  geom_line(color = &quot;blue&quot;, size = 1) +
  geom_ribbon(aes(ymin = lower_mse, ymax = upper_mse), alpha = 0.2, fill = &quot;blue&quot;) +
  geom_vline(xintercept = log_best_lambda, linetype = &quot;dashed&quot;, color = &quot;red&quot;) +
  labs(
    title = &quot;Cross-Validation for Lasso Regression&quot;,
    x = &quot;Log(Lambda)&quot;,
    y = &quot;Mean Cross-Validated Error&quot;
  ) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code># 获取模型在最佳 lambda 下的系数
lasso_coefficients &lt;- coef(cv_model, s = &quot;lambda.min&quot;)

# 将系数转换为数据框以便查看
lasso_coefficients_df &lt;- as.data.frame(as.matrix(lasso_coefficients)) %&gt;%
  rownames_to_column(&quot;Variable&quot;) %&gt;%
  rename(Coefficient = 1) %&gt;%
  filter(Coefficient != 0)  # 筛选非零系数的变量

kable(
  lasso_coefficients_df,
  caption = &quot;Cross-Validation Results for Lasso Regression&quot;,
  align = &quot;c&quot;,
  digits = 4
) |&gt; 
  kable_styling(
    bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;),
    full_width = TRUE
  ) |&gt; 
  scroll_box(height = &quot;300px&quot;)</code></pre>
<div
style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; ">
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Cross-Validation Results for Lasso Regression
</caption>
<thead>
<tr>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
Coefficient
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
s1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
X.Intercept.
</td>
<td style="text-align:center;">
1.1045
</td>
</tr>
<tr>
<td style="text-align:center;">
X.Intercept..1
</td>
<td style="text-align:center;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:center;">
year2016
</td>
<td style="text-align:center;">
0.0596
</td>
</tr>
<tr>
<td style="text-align:center;">
year2017
</td>
<td style="text-align:center;">
0.1478
</td>
</tr>
<tr>
<td style="text-align:center;">
year2018
</td>
<td style="text-align:center;">
0.0718
</td>
</tr>
<tr>
<td style="text-align:center;">
year2019
</td>
<td style="text-align:center;">
0.0956
</td>
</tr>
<tr>
<td style="text-align:center;">
year2020
</td>
<td style="text-align:center;">
-0.2817
</td>
</tr>
<tr>
<td style="text-align:center;">
year2021
</td>
<td style="text-align:center;">
-0.2844
</td>
</tr>
<tr>
<td style="text-align:center;">
month2
</td>
<td style="text-align:center;">
-0.0156
</td>
</tr>
<tr>
<td style="text-align:center;">
month3
</td>
<td style="text-align:center;">
0.0016
</td>
</tr>
<tr>
<td style="text-align:center;">
month4
</td>
<td style="text-align:center;">
0.1053
</td>
</tr>
<tr>
<td style="text-align:center;">
month5
</td>
<td style="text-align:center;">
0.1585
</td>
</tr>
<tr>
<td style="text-align:center;">
month6
</td>
<td style="text-align:center;">
0.2270
</td>
</tr>
<tr>
<td style="text-align:center;">
month7
</td>
<td style="text-align:center;">
0.1850
</td>
</tr>
<tr>
<td style="text-align:center;">
month8
</td>
<td style="text-align:center;">
0.2069
</td>
</tr>
<tr>
<td style="text-align:center;">
month9
</td>
<td style="text-align:center;">
0.1204
</td>
</tr>
<tr>
<td style="text-align:center;">
month10
</td>
<td style="text-align:center;">
0.0697
</td>
</tr>
<tr>
<td style="text-align:center;">
month11
</td>
<td style="text-align:center;">
0.0606
</td>
</tr>
<tr>
<td style="text-align:center;">
month12
</td>
<td style="text-align:center;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:center;">
genderM
</td>
<td style="text-align:center;">
0.8882
</td>
</tr>
<tr>
<td style="text-align:center;">
spay_neuterNeutered
</td>
<td style="text-align:center;">
-0.1036
</td>
</tr>
<tr>
<td style="text-align:center;">
boroughBrooklyn
</td>
<td style="text-align:center;">
0.2997
</td>
</tr>
<tr>
<td style="text-align:center;">
boroughManhattan
</td>
<td style="text-align:center;">
0.2269
</td>
</tr>
<tr>
<td style="text-align:center;">
boroughQueens
</td>
<td style="text-align:center;">
0.4948
</td>
</tr>
<tr>
<td style="text-align:center;">
boroughStaten.Island
</td>
<td style="text-align:center;">
-0.5572
</td>
</tr>
</tbody>
</table>
</div>
<p>Lasso
回归的主要目的是通过正则化减少模型中过多的变量，从而避免过拟合。Lasso
模型选择了以下变量：</p>
<ul>
<li>时间因素：year 和 month</li>
<li>个体特征：gender 和 spay_neuter</li>
<li>地区特征：borough 这些变量都包含在最终的模型 glm.nb()
中，因此可以确认目前的模型包含了 Lasso 结果所建议的关键变量。</li>
</ul>
</div>
<div id="主效应model" class="section level2">
<h2>主效应model</h2>
<p>通过 Lasso 回归对数据进行特征选择后，我们识别了几个关键变量，包括年份
(year)、月份 (month)、性别 (gender)、绝育状态 (spay_neuter) 和所在地区
(borough)。这些变量被纳入最终的负二项广义线性模型 (glm.nb)
中，以预测咬伤事件数量 (bite_count)。</p>
<div id="建模" class="section level3">
<h3>建模</h3>
<pre class="r"><code>library(MASS)

model = glm.nb(bite_count ~ year + month + gender + spay_neuter + borough, data = bites_by_group)

model_summary &lt;- tidy(model) %&gt;%
  mutate(
    significance = case_when(
      p.value &lt; 0.001 ~ &quot;***&quot;,
      p.value &lt; 0.01 ~ &quot;**&quot;,
      p.value &lt; 0.05 ~ &quot;*&quot;,
      TRUE ~ &quot;&quot;
    )
  )

kable(
  model_summary,
  col.names = c(&quot;Term&quot;, &quot;Estimate&quot;, &quot;SE&quot;, &quot;Statistic&quot;, &quot;P-value&quot;, &quot;Significance&quot;),
  caption = &quot;Summary of Negative Binomial Regression Results&quot;
) %&gt;%
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;), full_width = TRUE) %&gt;%
  scroll_box(height = &quot;400px&quot;)</code></pre>
<div
style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; ">
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
Summary of Negative Binomial Regression Results
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Term
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Estimate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
SE
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Statistic
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
P-value
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Significance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
1.0819840
</td>
<td style="text-align:right;">
0.0594554
</td>
<td style="text-align:right;">
18.1982535
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
year2016
</td>
<td style="text-align:right;">
0.0697408
</td>
<td style="text-align:right;">
0.0415739
</td>
<td style="text-align:right;">
1.6775135
</td>
<td style="text-align:right;">
0.0934421
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
year2017
</td>
<td style="text-align:right;">
0.1535577
</td>
<td style="text-align:right;">
0.0409067
</td>
<td style="text-align:right;">
3.7538482
</td>
<td style="text-align:right;">
0.0001741
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
year2018
</td>
<td style="text-align:right;">
0.0752355
</td>
<td style="text-align:right;">
0.0415347
</td>
<td style="text-align:right;">
1.8113915
</td>
<td style="text-align:right;">
0.0700803
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
year2019
</td>
<td style="text-align:right;">
0.0942075
</td>
<td style="text-align:right;">
0.0413851
</td>
<td style="text-align:right;">
2.2763627
</td>
<td style="text-align:right;">
0.0228243
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
year2020
</td>
<td style="text-align:right;">
-0.2791303
</td>
<td style="text-align:right;">
0.0454262
</td>
<td style="text-align:right;">
-6.1446913
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
year2021
</td>
<td style="text-align:right;">
-0.2870956
</td>
<td style="text-align:right;">
0.0458795
</td>
<td style="text-align:right;">
-6.2576004
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
month2
</td>
<td style="text-align:right;">
0.0025297
</td>
<td style="text-align:right;">
0.0587213
</td>
<td style="text-align:right;">
0.0430799
</td>
<td style="text-align:right;">
0.9656378
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
month3
</td>
<td style="text-align:right;">
0.0299763
</td>
<td style="text-align:right;">
0.0582325
</td>
<td style="text-align:right;">
0.5147697
</td>
<td style="text-align:right;">
0.6067140
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
month4
</td>
<td style="text-align:right;">
0.1274838
</td>
<td style="text-align:right;">
0.0571182
</td>
<td style="text-align:right;">
2.2319298
</td>
<td style="text-align:right;">
0.0256196
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
month5
</td>
<td style="text-align:right;">
0.1807138
</td>
<td style="text-align:right;">
0.0565828
</td>
<td style="text-align:right;">
3.1937937
</td>
<td style="text-align:right;">
0.0014042
</td>
<td style="text-align:left;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
month6
</td>
<td style="text-align:right;">
0.2447988
</td>
<td style="text-align:right;">
0.0559689
</td>
<td style="text-align:right;">
4.3738342
</td>
<td style="text-align:right;">
0.0000122
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
month7
</td>
<td style="text-align:right;">
0.2019422
</td>
<td style="text-align:right;">
0.0565467
</td>
<td style="text-align:right;">
3.5712485
</td>
<td style="text-align:right;">
0.0003553
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
month8
</td>
<td style="text-align:right;">
0.2276408
</td>
<td style="text-align:right;">
0.0563495
</td>
<td style="text-align:right;">
4.0397994
</td>
<td style="text-align:right;">
0.0000535
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
month9
</td>
<td style="text-align:right;">
0.1429531
</td>
<td style="text-align:right;">
0.0571015
</td>
<td style="text-align:right;">
2.5034925
</td>
<td style="text-align:right;">
0.0122974
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
month10
</td>
<td style="text-align:right;">
0.0912030
</td>
<td style="text-align:right;">
0.0577714
</td>
<td style="text-align:right;">
1.5786867
</td>
<td style="text-align:right;">
0.1144079
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
month11
</td>
<td style="text-align:right;">
0.0888914
</td>
<td style="text-align:right;">
0.0577247
</td>
<td style="text-align:right;">
1.5399200
</td>
<td style="text-align:right;">
0.1235799
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
month12
</td>
<td style="text-align:right;">
0.0185023
</td>
<td style="text-align:right;">
0.0588556
</td>
<td style="text-align:right;">
0.3143674
</td>
<td style="text-align:right;">
0.7532420
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
genderM
</td>
<td style="text-align:right;">
0.8851206
</td>
<td style="text-align:right;">
0.0245208
</td>
<td style="text-align:right;">
36.0966638
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
spay_neuterNeutered
</td>
<td style="text-align:right;">
-0.1122779
</td>
<td style="text-align:right;">
0.0228317
</td>
<td style="text-align:right;">
-4.9176281
</td>
<td style="text-align:right;">
0.0000009
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
boroughBrooklyn
</td>
<td style="text-align:right;">
0.3051114
</td>
<td style="text-align:right;">
0.0361136
</td>
<td style="text-align:right;">
8.4486684
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
boroughManhattan
</td>
<td style="text-align:right;">
0.2376617
</td>
<td style="text-align:right;">
0.0365134
</td>
<td style="text-align:right;">
6.5088955
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
boroughQueens
</td>
<td style="text-align:right;">
0.4981809
</td>
<td style="text-align:right;">
0.0349699
</td>
<td style="text-align:right;">
14.2459962
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
boroughStaten Island
</td>
<td style="text-align:right;">
-0.5517553
</td>
<td style="text-align:right;">
0.0446767
</td>
<td style="text-align:right;">
-12.3499477
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:left;">
***
</td>
</tr>
</tbody>
</table>
</div></li>
</ul></li>
</ul></li>
</ul>
<p>从结果来看，。。。</p>
<p>模型还需要进一步evaluate。</p>
<div id="evaluation" class="section level3">
<h3>evaluation</h3>
<p><strong>Multicollinearity Check</strong></p>
<pre class="r"><code>library(car)
vif_results &lt;- vif(model) %&gt;%
  as.data.frame() %&gt;%
  rownames_to_column(&quot;Predictor&quot;) %&gt;%
  rename(
    GVIF = GVIF,
    DF = Df,
    `GVIF^(1/(2*DF))` = `GVIF^(1/(2*Df))`
  )

kable(
  vif_results,
  col.names = c(&quot;Predictor&quot;, &quot;GVIF&quot;, &quot;DF&quot;, &quot;Scaled GVIF&quot;),
  caption = &quot;Multicollinearity Check (GVIF)&quot;
) |&gt; 
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;), full_width = FALSE)</code></pre>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Multicollinearity Check (GVIF)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Predictor
</th>
<th style="text-align:right;">
GVIF
</th>
<th style="text-align:right;">
DF
</th>
<th style="text-align:right;">
Scaled GVIF
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
year
</td>
<td style="text-align:right;">
1.004775
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1.000397
</td>
</tr>
<tr>
<td style="text-align:left;">
month
</td>
<td style="text-align:right;">
1.002312
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
1.000105
</td>
</tr>
<tr>
<td style="text-align:left;">
gender
</td>
<td style="text-align:right;">
1.003175
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.001586
</td>
</tr>
<tr>
<td style="text-align:left;">
spay_neuter
</td>
<td style="text-align:right;">
1.001316
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.000658
</td>
</tr>
<tr>
<td style="text-align:left;">
borough
</td>
<td style="text-align:right;">
1.005447
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1.000679
</td>
</tr>
</tbody>
</table>
<p>GVIF: Measures the multicollinearity in the regression model. A GVIF
value greater than 10 generally indicates a high multicollinearity
issue. All GVIF values are close to 1, suggesting no significant
multicollinearity.</p>
<p>GVIF^(1/(2*Df)):</p>
<p>A scaled version of GVIF for categorical variables. This value
adjusts GVIF based on the degrees of freedom to make it comparable
across variables. In your results, all values are very close to 1,
further confirming no multicollinearity.</p>
<p><code>model</code> does not exhibit multicollinearity among the
predictors, as all GVIF values and their scaled counterparts are well
below the threshold of concern (commonly 10 or higher).</p>
<p>This indicates that all predictors can be reliably used in regression
model without the risk of biased coefficients caused by
multicollinearity.</p>
<p><strong>Residual Analysis</strong></p>
<pre class="r"><code>library(DHARMa)
residuals_sim = simulateResiduals(model)
plot(residuals_sim)</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<ul>
<li>QQ：<code>model</code>在残差分析</li>
</ul>
</div>
<div id="with-interaction" class="section level2">
<h2>With Interaction</h2>
<p>To further increase the precision of the model fit, interaction terms
between variables were added. After using stepwise reduction to simplify
the model complexity, the final negative binomial regression model is as
follows: ### 建模</p>
<pre class="r"><code>data &lt;- data.frame(
  `Main Effect` = c(&quot;year&quot;, &quot;month&quot;, &quot;gender&quot;, &quot;spay_neuter&quot;, &quot;borough&quot;, &quot; &quot;),
  `Double Interaction Effect` = c(
    &quot;year * spay_neuter&quot;,
    &quot;year * borough&quot;,
    &quot;month * spay_neuter&quot;,
    &quot;gender * spay_neuter&quot;,
    &quot;gender * borough&quot;,
    &quot;spay_neuter * borough&quot;
  )
)

knitr::kable(data, format = &quot;pipe&quot;, align = &quot;l&quot;, caption = &quot;Final Negative Binomial Regression Model&quot;, escape = FALSE)</code></pre>
<table>
<caption>Final Negative Binomial Regression Model</caption>
<thead>
<tr class="header">
<th align="left">Main.Effect</th>
<th align="left">Double.Interaction.Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">year</td>
<td align="left">year * spay_neuter</td>
</tr>
<tr class="even">
<td align="left">month</td>
<td align="left">year * borough</td>
</tr>
<tr class="odd">
<td align="left">gender</td>
<td align="left">month * spay_neuter</td>
</tr>
<tr class="even">
<td align="left">spay_neuter</td>
<td align="left">gender * spay_neuter</td>
</tr>
<tr class="odd">
<td align="left">borough</td>
<td align="left">gender * borough</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">spay_neuter * borough</td>
</tr>
</tbody>
</table>
<pre class="r"><code>filter_model = glm.nb(bite_count ~ year + month + gender + spay_neuter + 
    borough + year:spay_neuter + year:borough + month:spay_neuter + 
    gender:spay_neuter + gender:borough + spay_neuter:borough, 
    data = bites_by_group)</code></pre>
<pre><code>## Warning in theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace =
## control$trace &gt; : iteration limit reached
## Warning in theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace =
## control$trace &gt; : iteration limit reached</code></pre>
<pre class="r"><code>summary(filter_model)</code></pre>
<pre><code>## 
## Call:
## glm.nb(formula = bite_count ~ year + month + gender + spay_neuter + 
##     borough + year:spay_neuter + year:borough + month:spay_neuter + 
##     gender:spay_neuter + gender:borough + spay_neuter:borough, 
##     data = bites_by_group, init.theta = 35483.63491, link = log)
## 
## Coefficients:
##                                           Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)                               1.341982   0.091715  14.632  &lt; 2e-16
## year2016                                  0.264946   0.090104   2.940 0.003277
## year2017                                  0.129712   0.092290   1.405 0.159878
## year2018                                  0.271432   0.090817   2.989 0.002801
## year2019                                  0.271740   0.090544   3.001 0.002689
## year2020                                 -0.194931   0.104705  -1.862 0.062642
## year2021                                 -0.215686   0.107294  -2.010 0.044406
## month2                                   -0.027454   0.069567  -0.395 0.693106
## month3                                    0.010489   0.068496   0.153 0.878294
## month4                                   -0.006620   0.068491  -0.097 0.922998
## month5                                    0.065807   0.067283   0.978 0.328038
## month6                                    0.156214   0.065759   2.376 0.017522
## month7                                    0.190514   0.065407   2.913 0.003582
## month8                                    0.140605   0.066486   2.115 0.034448
## month9                                    0.032965   0.068063   0.484 0.628152
## month10                                   0.091623   0.067365   1.360 0.173794
## month11                                   0.017673   0.068307   0.259 0.795847
## month12                                  -0.012775   0.068906  -0.185 0.852919
## genderM                                   0.858813   0.054618  15.724  &lt; 2e-16
## spay_neuterNeutered                      -0.926300   0.109048  -8.494  &lt; 2e-16
## boroughBrooklyn                           0.138429   0.100729   1.374 0.169360
## boroughManhattan                         -0.330011   0.108318  -3.047 0.002314
## boroughQueens                             0.005221   0.100485   0.052 0.958560
## boroughStaten Island                     -0.735464   0.129502  -5.679 1.35e-08
## year2016:spay_neuterNeutered              0.059432   0.073885   0.804 0.421172
## year2017:spay_neuterNeutered              0.118824   0.072212   1.645 0.099869
## year2018:spay_neuterNeutered             -0.178941   0.073824  -2.424 0.015355
## year2019:spay_neuterNeutered             -0.105464   0.073298  -1.439 0.150195
## year2020:spay_neuterNeutered             -0.343394   0.083263  -4.124 3.72e-05
## year2021:spay_neuterNeutered             -0.351875   0.084249  -4.177 2.96e-05
## year2016:boroughBrooklyn                 -0.401051   0.113611  -3.530 0.000416
## year2017:boroughBrooklyn                 -0.221060   0.114629  -1.928 0.053795
## year2018:boroughBrooklyn                 -0.485118   0.116810  -4.153 3.28e-05
## year2019:boroughBrooklyn                 -0.441569   0.115885  -3.810 0.000139
## year2020:boroughBrooklyn                 -0.084009   0.130890  -0.642 0.520983
## year2021:boroughBrooklyn                 -0.086726   0.134072  -0.647 0.517722
## year2016:boroughManhattan                -0.265007   0.121969  -2.173 0.029800
## year2017:boroughManhattan                 0.005676   0.121403   0.047 0.962707
## year2018:boroughManhattan                 0.073638   0.120001   0.614 0.539453
## year2019:boroughManhattan                 0.036786   0.119708   0.307 0.758616
## year2020:boroughManhattan                 0.276769   0.136570   2.027 0.042706
## year2021:boroughManhattan                 0.216915   0.139749   1.552 0.120621
## year2016:boroughQueens                   -0.205677   0.113647  -1.810 0.070329
## year2017:boroughQueens                    0.083213   0.113586   0.733 0.463805
## year2018:boroughQueens                    0.043839   0.113139   0.387 0.698403
## year2019:boroughQueens                    0.021763   0.112744   0.193 0.846939
## year2020:boroughQueens                    0.118833   0.130621   0.910 0.362951
## year2021:boroughQueens                    0.255885   0.131547   1.945 0.051750
## year2016:boroughStaten Island            -0.145628   0.143157  -1.017 0.309031
## year2017:boroughStaten Island            -0.013484   0.142522  -0.095 0.924627
## year2018:boroughStaten Island            -0.183792   0.148307  -1.239 0.215246
## year2019:boroughStaten Island            -0.241500   0.146806  -1.645 0.099964
## year2020:boroughStaten Island            -0.115257   0.178990  -0.644 0.519622
## year2021:boroughStaten Island            -0.327040   0.192923  -1.695 0.090040
## month2:spay_neuterNeutered                0.093060   0.104601   0.890 0.373646
## month3:spay_neuterNeutered                0.057360   0.103859   0.552 0.580754
## month4:spay_neuterNeutered                0.304865   0.101057   3.017 0.002555
## month5:spay_neuterNeutered                0.267348   0.099878   2.677 0.007434
## month6:spay_neuterNeutered                0.221396   0.098430   2.249 0.024495
## month7:spay_neuterNeutered                0.053891   0.099843   0.540 0.589366
## month8:spay_neuterNeutered                0.204595   0.099156   2.063 0.039077
## month9:spay_neuterNeutered                0.251572   0.100921   2.493 0.012676
## month10:spay_neuterNeutered               0.021214   0.102592   0.207 0.836178
## month11:spay_neuterNeutered               0.158559   0.102491   1.547 0.121848
## month12:spay_neuterNeutered               0.077373   0.104968   0.737 0.461056
## genderM:spay_neuterNeutered              -0.127791   0.045308  -2.820 0.004795
## genderM:boroughBrooklyn                   0.158718   0.071433   2.222 0.026289
## genderM:boroughManhattan                  0.124864   0.072546   1.721 0.085221
## genderM:boroughQueens                     0.156415   0.068417   2.286 0.022243
## genderM:boroughStaten Island             -0.097614   0.091720  -1.064 0.287213
## spay_neuterNeutered:boroughBrooklyn       0.898637   0.069394  12.950  &lt; 2e-16
## spay_neuterNeutered:boroughManhattan      1.144141   0.070459  16.238  &lt; 2e-16
## spay_neuterNeutered:boroughQueens         0.975707   0.067006  14.561  &lt; 2e-16
## spay_neuterNeutered:boroughStaten Island  1.009285   0.086896  11.615  &lt; 2e-16
##                                             
## (Intercept)                              ***
## year2016                                 ** 
## year2017                                    
## year2018                                 ** 
## year2019                                 ** 
## year2020                                 .  
## year2021                                 *  
## month2                                      
## month3                                      
## month4                                      
## month5                                      
## month6                                   *  
## month7                                   ** 
## month8                                   *  
## month9                                      
## month10                                     
## month11                                     
## month12                                     
## genderM                                  ***
## spay_neuterNeutered                      ***
## boroughBrooklyn                             
## boroughManhattan                         ** 
## boroughQueens                               
## boroughStaten Island                     ***
## year2016:spay_neuterNeutered                
## year2017:spay_neuterNeutered             .  
## year2018:spay_neuterNeutered             *  
## year2019:spay_neuterNeutered                
## year2020:spay_neuterNeutered             ***
## year2021:spay_neuterNeutered             ***
## year2016:boroughBrooklyn                 ***
## year2017:boroughBrooklyn                 .  
## year2018:boroughBrooklyn                 ***
## year2019:boroughBrooklyn                 ***
## year2020:boroughBrooklyn                    
## year2021:boroughBrooklyn                    
## year2016:boroughManhattan                *  
## year2017:boroughManhattan                   
## year2018:boroughManhattan                   
## year2019:boroughManhattan                   
## year2020:boroughManhattan                *  
## year2021:boroughManhattan                   
## year2016:boroughQueens                   .  
## year2017:boroughQueens                      
## year2018:boroughQueens                      
## year2019:boroughQueens                      
## year2020:boroughQueens                      
## year2021:boroughQueens                   .  
## year2016:boroughStaten Island               
## year2017:boroughStaten Island               
## year2018:boroughStaten Island               
## year2019:boroughStaten Island            .  
## year2020:boroughStaten Island               
## year2021:boroughStaten Island            .  
## month2:spay_neuterNeutered                  
## month3:spay_neuterNeutered                  
## month4:spay_neuterNeutered               ** 
## month5:spay_neuterNeutered               ** 
## month6:spay_neuterNeutered               *  
## month7:spay_neuterNeutered                  
## month8:spay_neuterNeutered               *  
## month9:spay_neuterNeutered               *  
## month10:spay_neuterNeutered                 
## month11:spay_neuterNeutered                 
## month12:spay_neuterNeutered                 
## genderM:spay_neuterNeutered              ** 
## genderM:boroughBrooklyn                  *  
## genderM:boroughManhattan                 .  
## genderM:boroughQueens                    *  
## genderM:boroughStaten Island                
## spay_neuterNeutered:boroughBrooklyn      ***
## spay_neuterNeutered:boroughManhattan     ***
## spay_neuterNeutered:boroughQueens        ***
## spay_neuterNeutered:boroughStaten Island ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Negative Binomial(35483.63) family taken to be 1)
## 
##     Null deviance: 4944.9  on 1572  degrees of freedom
## Residual deviance: 1437.1  on 1499  degrees of freedom
## AIC: 7045.8
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  35484 
##           Std. Err.:  232188 
## Warning while fitting theta: iteration limit reached 
## 
##  2 x log-likelihood:  -6895.762</code></pre>
<div id="model-evaluation" class="section level3">
<h3>Model evaluation</h3>
<p>Cross-validation of the final model is depicted in the following
illustration, where the red dashed line represents the ideal prediction
scenario (i.e., predicted values equal actual values). If points fall
near this line, it indicates that the model predicts well. Points
located above the diagonal line suggest that the model underestimates
the actual values; conversely, if points are below the diagonal line,
the model overestimates the actual values.</p>
<p>Overall, while the scatter plot shows a slight systematic deviation,
the final negative binomial regression model still accurately predicts
low and medium value areas. However, the error is larger in high-value
areas, where actual values tend to fall below the predicted values. This
may indicate a tendency of the model to overfit in regions with high
incident counts.</p>
<div id="significance-evaluation" class="section level4">
<h4>Significance evaluation</h4>
<pre class="r"><code>filter_model_summary &lt;- tidy(filter_model, exponentiate = TRUE, conf.int = TRUE)
print(filter_model_summary)</code></pre>
<pre><code>## # A tibble: 74 × 7
##    term        estimate std.error statistic  p.value conf.low conf.high
##    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)    3.83     0.0917   14.6    1.75e-48    3.19      4.57 
##  2 year2016       1.30     0.0901    2.94   3.28e- 3    1.09      1.56 
##  3 year2017       1.14     0.0923    1.41   1.60e- 1    0.950     1.36 
##  4 year2018       1.31     0.0908    2.99   2.80e- 3    1.10      1.57 
##  5 year2019       1.31     0.0905    3.00   2.69e- 3    1.10      1.57 
##  6 year2020       0.823    0.105    -1.86   6.26e- 2    0.669     1.01 
##  7 year2021       0.806    0.107    -2.01   4.44e- 2    0.652     0.993
##  8 month2         0.973    0.0696   -0.395  6.93e- 1    0.849     1.11 
##  9 month3         1.01     0.0685    0.153  8.78e- 1    0.884     1.16 
## 10 month4         0.993    0.0685   -0.0967 9.23e- 1    0.869     1.14 
## # ℹ 64 more rows</code></pre>
</div>
<div id="interaction-effect-visualization" class="section level4">
<h4>Interaction effect visualization</h4>
<pre class="r"><code>library(effects)

interaction_effect_y_bo &lt;- effect(&quot;year:borough&quot;, filter_model)
plot(interaction_effect_y_bo,
     main = &quot;Interaction Effect of Year and Borough on Bite Count&quot;,
     xlab = &quot;Year&quot;,
     ylab = &quot;Predicted Bite Count&quot;)</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code>library(ggeffects)

# 提取交互效应预测
interaction_preds &lt;- ggpredict(filter_model, terms = c(&quot;year&quot;, &quot;borough&quot;))

# 可视化交互效应
ggplot(interaction_preds, aes(x = x, y = predicted, color = group)) +
  geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.2) +
  labs(
    title = &quot;Predicted Bite Counts by Year and Borough&quot;,
    x = &quot;Year&quot;,
    y = &quot;Predicted Bite Count&quot;,
    color = &quot;Borough&quot;
  ) +
  theme_minimal()</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="prediction" class="section level4">
<h4>Prediction</h4>
<p>In the plot, the red dashed line represents the ideal prediction
scenario where the predicted values equal the actual values. Points
close to this line indicate that the model is performing well in its
predictions. If points are positioned above the diagonal line, it
suggests that the model has underestimated the actual values;
conversely, if points are located below the diagonal line, it indicates
that the model has overestimated the actual values. 。</p>
<pre class="r"><code># Predicted vs Actual Bite Count
inter_predict = bites_by_group |&gt; 
  mutate(predicted = predict(model_stepwise, type = &quot;response&quot;))

ggplot(inter_predict, aes(x = predicted, y = bite_count)) +
  geom_point(alpha = 0.5) +
  geom_abline(slope = 1, intercept = 0, color = &quot;red&quot;, linetype = &quot;dashed&quot;) +
  labs(title = &quot;Predicted vs. Actual Bite Count&quot;,
       x = &quot;Predicted Bite Count&quot;,
       y = &quot;Actual Bite Count&quot;) +
  theme_minimal()</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Additionally, the quality of the fitted model can be assessed through
residual analysis and diagnostics, as illustrated in the following four
plots.</p>
<ul>
<li>Residual vs. Fitted Plot:</li>
</ul>
<p>This graph helps to detect non-linearity, unequal error variances,
and outliers. Ideally, the residuals should be randomly dispersed around
the horizontal axis, meaning the red dashed line (a smooth curve) should
be close to a horizontal straight line.</p>
<ul>
<li>Q-Q Plot:</li>
</ul>
<p>This plot is used to check whether the residuals conform to the
distribution assumed by the model.</p>
<ul>
<li>Scale-Location Plot:</li>
</ul>
<p>This plot shows the spread of residuals versus fitted values and
helps to check for homoscedasticity (constant spread of residuals). A
model that meets this assumption will show a horizontal line with
randomly spread points.</p>
<ul>
<li>Residuals vs. Leverage Plot:</li>
</ul>
<p>This plot is critical for identifying observations with high leverage
values—points that have a significant impact on the model’s fit.
Ideally, no points should exceed the threshold set by Cook’s distance,
indicated by the dashed lines.</p>
</div>
<div id="残差分析" class="section level4">
<h4>残差分析</h4>
<pre class="r"><code>library(DHARMa)
residuals_sim = simulateResiduals(model_stepwise)
plot(model_stepwise)</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-15-1.png" width="672" /><img src="regression_files/figure-html/unnamed-chunk-15-2.png" width="672" /><img src="regression_files/figure-html/unnamed-chunk-15-3.png" width="672" /><img src="regression_files/figure-html/unnamed-chunk-15-4.png" width="672" /></p>
<p>From the analysis of the four diagnostic plots, the fitted model
exhibits several shortcomings. Firstly, the tails of the residual
distribution slightly deviate from the assumed negative binomial
distribution. This deviation suggests that the residuals might not be
perfectly modeled, indicating potential issues with the model fit or the
distributional assumptions. Secondly, the distribution of points in the
Scale-Location plot appears striated, and the red smooth line shows a
non-horizontal trend. This pattern indicates that the variance of the
residuals may change with fitted values, suggesting the presence of
heteroscedasticity. This non-constant variance can affect the
reliability of the model’s standard errors and confidence
intervals.Lastly, the Residuals vs Leverage Plot reveals the presence of
points with high leverage, which could be overly influencing the model’s
predictions. These high leverage points warrant further investigation to
determine whether they should be removed or adjusted to improve model
accuracy and robustness.</p>
</div>
</div>
</div>
<div id="两模型对比" class="section level2">
<h2>两模型对比</h2>
</div>
<div id="generalized-linear-mixed-model-glmm" class="section level1">
<h1>Generalized Linear Mixed Model (GLMM)</h1>
<p>为了解决上述模型拟合问题，本文进一步使用Generalized Linear Mixed
Model (GLMM)对拟合模型进行优化。</p>
<p>The Generalized Linear Mixed Model (GLMM) is an extension of the
Generalized Linear Model (GLM) and the Linear Mixed Model (LMM). GLMM
consists of three main components: random effects, fixed effects, and a
link function. Fixed effects represent the overall level parameters
consistent across all observations, while random effects account for
individual variability or group-level differences that may influence the
response variable. The link function connects the linear predictor to
the mean of the response variable distribution, allowing the dependent
variable to deviate from a normal distribution and enabling modeling of
various types of data, including binary, count, and continuous
outcomes.</p>
<p>Let the response variable <span class="math inline">\(y\)</span>
belongs to the exponential family, its conditional distribution can be
expressed as follows:</p>
<p><span class="math display">\[f(y|b) = \prod\limits_{i = 1}^n
{f({y_i}|{\eta _i})}\]</span></p>
<p>Where <span class="math inline">\({\eta _i} = {x_i}^ \top \beta  +
{z_i}^ \top b\)</span>. Additionally, the random effect <span
class="math inline">\(b\)</span> is assumed to be distributed according
to <span class="math inline">\(b \sim {\rm N}(0,\Sigma )\)</span>.</p>
<p>Therefore the GLMM is structured as follows:</p>
<p><span class="math display">\[g(\vec {\rm E}(y)) = {\rm X}\vec
\beta  + {\rm Z}\vec b + \varepsilon\]</span></p>
<p>In the model, <span class="math inline">\(g( \cdot )\)</span>
represents the link function, which connects the expected value of the
response variable to the linear predictor. Here, the logarithm function
<span class="math inline">\(g(\mu ) = \ln (\mu )\)</span> is used, which
is appropriate for the Poisson distribution. <span
class="math inline">\(\vec{\mathrm{E}}(y)\)</span> denotes the vector of
expected values for the response variable, and <span
class="math inline">\(\varepsilon\)</span> represents the error term,
capturing random noise or the unexplained variance. <span
class="math inline">\({\rm X}\vec \beta  + {\rm Z}\vec b\)</span>
represents the linear combination of fixed and random effects, <span
class="math inline">\({\rm X}\vec \beta\)</span> is used to explain
global trends, and <span class="math inline">\({\rm Z}\vec b\)</span> is
utilized to capture differences among observations. In this context,
<span class="math inline">\({\rm X}\)</span> is the design matrix for
fixed effects, which is of order <span class="math inline">\(n \times
p\)</span>, where <span class="math inline">\(n\)</span> is the number
of observations and <span class="math inline">\(p\)</span> is the number
of fixed effect variables; <span class="math inline">\(\vec
\beta\)</span> is the vector of coefficients for fixed effects, with
each element representing the regression coefficient of a fixed effect
variable. Similarly, <span class="math inline">\({\rm Z}\)</span> also
serves as the design matrix for random effects, of order <span
class="math inline">\(n \times q\)</span>, where <span
class="math inline">\(q\)</span> is the number of random effect
variables. <span class="math inline">\(\vec b\)</span> is the vector of
coefficients for random effects, representing inter-group deviations
used to explain random differences between groups. The model assumes
<span class="math inline">\(b \sim {\rm N}(0,\Sigma )\)</span>, thereby
the random effects are normally distributed with a mean of <span
class="math inline">\(0\)</span> and a covariance matrix <span
class="math inline">\(\Sigma\)</span>.</p>
<p>For the dog bite incidents dataset, the response variable <span
class="math inline">\(y\)</span> represents the number of dog bite
incidents per zipcode per month. Fixed effects in the model include
year, month, gender, and sterilization status. Random effects are
attributed to different boroughs (5 boroughs in total). Thus, for all
response variables, <span class="math inline">\({\rm X}\)</span> is a
matrix containing year, month, gender, and sterilization status; <span
class="math inline">\(\vec \beta\)</span> represents the coefficients
for the fixed effects; <span class="math inline">\({\rm X}\)</span>
indicates the matrix for the borough each response variable belongs to;
and <span class="math inline">\(\vec b\)</span> denotes the deviation
for each borough (random effects). This setup allows the model to adjust
for the influence of both environmental conditions and borough-specific
variations in the occurrence of dog bites.</p>
<pre class="r"><code>library(lme4)
glmm_model = glmer.nb(
  bite_count ~ year + month + gender + spay_neuter + (1 | borough), 
  data = bites_by_group
)
summary(glmm_model)</code></pre>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: Negative Binomial(24.7739)  ( log )
## Formula: bite_count ~ year + month + gender + spay_neuter + (1 | borough)
##    Data: bites_by_group
## 
##      AIC      BIC   logLik deviance df.resid 
##   7428.7   7546.6  -3692.3   7384.7     1551 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.2530 -0.7004 -0.1379  0.5946  4.3986 
## 
## Random effects:
##  Groups  Name        Variance Std.Dev.
##  borough (Intercept) 0.1297   0.3601  
## Number of obs: 1573, groups:  borough, 5
## 
## Fixed effects:
##                      Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)          1.180466   0.169985   6.945 3.80e-12 ***
## year2016             0.069807   0.041693   1.674 0.094071 .  
## year2017             0.153530   0.040995   3.745 0.000180 ***
## year2018             0.075276   0.041613   1.809 0.070459 .  
## year2019             0.094146   0.041424   2.273 0.023043 *  
## year2020            -0.278894   0.045542  -6.124 9.13e-10 ***
## year2021            -0.286869   0.045945  -6.244 4.27e-10 ***
## month2               0.002486   0.058859   0.042 0.966312    
## month3               0.029950   0.058421   0.513 0.608193    
## month4               0.127434   0.057260   2.226 0.026045 *  
## month5               0.180648   0.056723   3.185 0.001449 ** 
## month6               0.244653   0.056072   4.363 1.28e-05 ***
## month7               0.201824   0.056634   3.564 0.000366 ***
## month8               0.227600   0.056477   4.030 5.58e-05 ***
## month9               0.142905   0.057233   2.497 0.012529 *  
## month10              0.091131   0.057893   1.574 0.115462    
## month11              0.088930   0.057918   1.535 0.124671    
## month12              0.018499   0.059010   0.313 0.753909    
## genderM              0.884882   0.024565  36.023  &lt; 2e-16 ***
## spay_neuterNeutered -0.112301   0.022910  -4.902 9.50e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div id="残差分析-1" class="section level4">
<h4>残差分析</h4>
<pre class="r"><code>library(DHARMa)
residuals_glmm_sim = simulateResiduals(glmm_model)
plot(residuals_glmm_sim)</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-17-1.png" width="672" />
有outlier，所以该模型并不。。。</p>
</div>
</div>
<div id="model对比" class="section level1">
<h1>Model对比：</h1>
<p>三者相比，AIC。。。 并且，残差分析显示，只有with
interaction的有意义。</p>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>三个模型对比，只含有主效应的model。。。。 含有inter。。。
后续生成的。。。但是能解释一些。。。</p>
</div>
</div>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
